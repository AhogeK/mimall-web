## 项目基础构建
### 跨域-CORS
#### 前端跨域解决方案
* 什么是前端跨域
  * 跨域是浏览器为了安全而做出的限制策略
  * 浏览器请求必须遵循同源策略: 同域名、同端口、同协议
* 怎么解决前端跨域
  * CORS跨域
    * CORS跨域-服务端设置，前端直接调用
      * 后台允许前端某个站点进行访问
  * JSONP跨域
  * 代理跨域

Response Headers中：
Access-Control-Allow-Credentials:true 如后端取不到你的Cookie，前端发请求时一定要设置这个选项为true。
Access-Control-Allow-Origin：http://localhost:8080 此设置可允许前端跨域。

### 跨域-JSONP

前端适配，后端配合（前后台同时改造）**目前较为流行**

前端安装JSONP插件
下载：cnpm i jsonp --save-dev

导入：import jsonp from …

格式:
```
jsonp (url,(err,res){
    this.data.list = res.data;
})
```

个人大白话理解：
通过JSONP插件调用跨域接口，
JSONP不是通过接口请求方式调用的
是通过引入一个js脚本，执行脚本中的函数，进行返回数据

### 跨域-代理跨域
通过修改nginx服务器配置来实现

前端修改，后台不动

vue 也可以通过 node 实现代理
需要在项目里创建 ``vue.config.js`` 进行相关配置

### 需求梳理
* 熟悉文档、查看原型、读懂需求
* 了解前端设计搞 - 设计前端业务架构
* 了解后台接口文档 - 制定相关对接规范
* 协调资源
* 搭建前端架构

### 目录结构设计

大图片建议放在public目录之下，小图片（如icon或者css图片文件）放在src/assets目录之下

```js
<script>
import axios from 'axios' 
import jsonp from 'jsonp'

export default {
  name: 'App',
  components: {
    
  },
  mounted() {
    let url = "https://www.easy-mock.com/mock/5b012c1fe6e1035843cd3aff/mockapi/table/list";
    axios.get(url).then(() => {

    });
    url = "https://www.imooc.com/common/adver-getadver";
    jsonp(url, (err, res) => {
      let result = res;
      console.log(result);
    });
    axios.get("/common/adver-getadver").then(() => {
      
    })
  }
}
</script>
```
```
.
|- public         公共文件
|  |- imgs        图片
|  |- mock        接口信息
|- resurce        相关文档
|- src            源码
|  |- api         接口调用相关
|  |- assets      经过webpack处理的资源
|  |- components  组件
|  |- pages       页面
|  |- storage     本地存储
|  |- util        工具
.
```

`main.js` 引入router模块

```js
import Vue from 'vue'
import App from './App.vue'
import router from './router'

Vue.config.productionTip = false

new Vue({
  router,
  render: h => h(App),
}).$mount('#app')
```

关于 `productionTip` `render` `$mount` 可参阅 [Vue API](https://cn.vuejs.org/v2/api/index.html)

`router.js` 路由配置文件

```js
import Vue from 'vue'
import Router from 'vue-router'
import Home from './pages/home'
import Index from './pages/index'
import Product from './pages/product'
import Detail from './pages/detail'
import Cart from './pages/cart'
import Order from './pages/order'
import OrderConfirm from './pages/orderConfirm'
import OrderList from './pages/orderList'
import OrderPay from './pages/orderPay'
import AliPay from './pages/alipay'

Vue.use(Router);

export default new Router({
    routes: [
        {
            path: '/',
            name: 'home',
            component: Home,
            redirect: '/index',
            children: [
                {
                    path: '/index',
                    name: 'index',
                    component: Index
                },
                {
                    path: '/product/:id',
                    name: 'product',
                    component: Product
                },
                {
                    path: '/detail/:id',
                    name: 'detail',
                    component: Detail
                }
            ]
        },
        {
            path: '/cart',
            name: 'cart',
            component: Cart,
        },
        {
            path: '/order',
            name: 'order',
            component: Order,
            children: [
                {
                    path: 'list',
                    name: 'order-list',
                    component: OrderList,
                },
                {
                    path: 'confirm',
                    name: 'order-confirm',
                    component: OrderConfirm
                },
                {
                    path: 'pay',
                    order: 'order-pay',
                    component: OrderPay
                },
                {
                    path: 'alipay',
                    order: 'alipay',
                    component: AliPay
                }
            ]
        }
    ]
});
```

*export 是 ES6的特性，如果通过 Babel 和 webpack 就使用的 ES2015 模块，利用import与export进行注册操作*

关于 router 的相关参数属性可以查阅[官方文档](https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html)

页面可以通过<router-view>标签来显示对应组件内容，组件也可以通过注册使用其他组件标签，例如：

```js
<template>
    <div>
        order
        <order-header></order-header>
        <router-view></router-view>
        <nav-footer></nav-footer>
    </div>
</template>

<script>
import OrderHeader from './../components/OrderHeader'
import NavFooter from './../components/NavFooter'

export default {
    name: 'order',
    components: {
        OrderHeader,
        NavFooter
    }
}
</script>
```

*当中，如果地址为 `order/list`而`list`是order在router配置中的子路径，所以其<router-view>就会指向OrderList模组*

### Storage封装

* Cookie、localStorage、sessionStorage 三者区别？
  * 存储大小：Cokkie4K、Storage5M
  * 有效期：Cookie拥有有效期，Storage永久存储
  * Cookie会发送到服务器端，存储在内存中，Storage只存储在浏览器端
  * 路径：Cookie有路径限制，Storage只存储在域名下
  * API：Cookie没有特定的API，Storage有对应API
* 为什么要封装Storage，本身不是已经有API？
  * Storage本身有API，但是只是简单的key/value形式
  * Storage只存储字符串，需要收工转换成json对象
  * Storage只能一次性清空，不能单个清空

```js
/**
 * Storage封装
 */
const STORAGE_KEY = 'mall';

export default {

    // 存储值
    setItem(key, value, module_name) {
        if (module_name) {
            let val = this.getItem(module_name);
            val[key] = value;
            this.setItem(module_name, val);
        } else {
            let val = this.getStorage();
            val[key] = value;
            window.sessionStorage.setItem(STORAGE_KEY, JSON.stringify(val));
        }
    },
    // 获取某一个模块下面的属性user下面的userName
    getItem(key, module_name) {
        if (module_name) {
            let val = this.getItem(module_name);
            if (val) return val[key];
        }
        return this.getStorage()[key];
    },
    getStorage() {
        return JSON.parse(window.sessionStorage.getItem(STORAGE_KEY || '{}'));
    },
    clear(key, module_name) {
        let val = this.getStorage();
        if (module_name) {
            delete val[module_name][key];
        } else {
            delete val[key];
        }
        window.sessionStorage.setItem(STORAGE_KEY, JSON.stringify(val));
    }
}
```

实际使用封装

```js
<template>
  <div id="app">
    <router-view></router-view>
  </div>
</template>

<script>
// import storage from './storage'

export default {
  name: 'App',
  mounted() {
    // storage.setItem('a', 1);
    // storage.setItem('user', {a : 1});
    // storage.setItem('abc', {a:1}, 'user');
    // storage.clear('user');
    // storage.clear('a', 'user');
  }
}
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
```

### 接口错误拦截

* 统一报错
* 未登录统一拦截
* 请求值、返回值统一处理

学习 [axios](https://www.npmjs.com/package/axios) 的使用

引用 axios 及相关配置

```js
import Vue from 'vue'
import router from './router'
import axios from 'axios'
import VueAxios from 'vue-axios'
import App from './App.vue'

// 根据前端的跨域方式做调整
axios.defaults.baseURL = '/api';
axios.defaults.timeout = 8000;

// 错误接口拦截
axios.interceptors.response.use(function(response) {
  let res = response.data;
  if (res.status ==0) {
    return res.data;
  } else if (res.status == 10) {
    window.location.href = '/#/login';
  } else {
    alert(res.msg);
  }
});

Vue.user(VueAxios, axios);
Vue.config.productionTip = false

new Vue({
  router,
  render: h => h(App),
}).$mount('#app')
```

``/#/login`` 是hash路径，详细可以看这篇文章[history与hash路由的区别](https://juejin.im/post/6844903625169502216)

### 接口环境设置

* 开发上线的不同阶段，需要不同的配置
* 不同的跨域方式，配置不同
* 打包的时候统一注入环境参数，统一管理环境，输出不同的版本包

环境设置：

新建自定义环境配置文件 env.js
```js
let baseURL;

switch (process.env.NODE_ENV) {
    case 'development':
        baseURL = 'http://dev-mall-pre.springboot.cn/api';
        break;
    case 'test':
        baseURL = 'http://test-mall-pre.springboot.cn/api';
        break;
    case 'production':
        baseURL = 'http://mall-pre.springboot.cn/api'
        break;
    default:
        baseURL = 'http://mall-pre.springboot.cn/api'
        break;
}

export default {
    baseURL
}
```

main.js 中引入自定义环境模块并引入
```js
import Vue from 'vue'
import router from './router'
import axios from 'axios'
import VueAxios from 'vue-axios'
import App from './App.vue'
import env from './env'

// 根据前端的跨域方式做调整
axios.defaults.baseURL = '/api';
axios.defaults.timeout = 8000;

// 根据环境变量获取不同的请求地址
axios.defaults.baseURL = env.baseURL;

// 错误接口拦截
axios.interceptors.response.use(function(response) {
  let res = response.data;
  if (res.status ==0) {
    return res.data;
  } else if (res.status == 10) {
    window.location.href = '/#/login';
  } else {
    alert(res.msg);
  }
});

Vue.user(VueAxios, axios);
Vue.config.productionTip = false

new Vue({
  router,
  render: h => h(App),
}).$mount('#app')
```

不包含的类型可以通过简历自定义文件添加

建立文件 `.env.自定义名`
```
NODE_ENV='自定义名'
```

*NODE_ENV 即运行时获取的 --mode值，具体在 package.json 中添加 需要相互匹配，具体可看 [webpack相关文档配置](https://webpack.docschina.org/configuration/mode/)*

```json
... ...
"scripts": {
    "serve": "vue-cli-service serve --mode=development",
    "build": "vue-cli-service build --mode=production",
    "test" : "vue-cli-service test --mode=test",
    "lint": "vue-cli-service lint"
  },
... ...
```

### Mock设置

* 开发阶段，为了高效率，需要提前Mock
* 减少代码冗余、灵活插拔
* 减少沟通、减少接口联调时间

#### 方案

* 本地创建json
* easy-mock平台
* 集成Mock API

#### 本地加载请求静态json文件的形式

```js
<script>
export default {
  name: 'App',
  data() {
    return {
      res: {}
    }
  },
  mounted() {
    // 本地夹在请求静态json文件的形式
    this.axios.get('/mock/user/login.json').then((res) => {
        this.res = res;
    });
  }
}
</script>
```

#### easy-mock 平台实现数据 mock

main.js
```
// 这里设置成easy-mock提供的url
axios.defaults.baseURL = '/api';
```

App.vue
```vue
<script>
export default {
  name: 'App',
  data() {
    return {
      res: {}
    }
  },
  mounted() {
    // 通过easy-mock平台实现数据mock
    this.axios.get('/user/login').then((res) => {
      this.res = res;
    });
  }
}
</script>
```

#### 本地集成 mockjs

先通过npm安装mockjs

``npm i mockjs --save-dev``

main.js
```js
// 定义mockjs开关 方便开关
const mock = true;
if (mock) {
  // import 预编译 require() 执行编译
  require('./mock/api')
}

// 根据前端的跨域方式做调整
axios.defaults.baseURL = '/api';
axios.defaults.timeout = 8000;
```

src下创建mock文件夹并添加api.js文件

api.js
```js
import Mock from 'mockjs';
Mock.mock('/api/user/login', {
    "status": 0,
    "data": {
        "id": 12,
        "username": "admin",
        "email": "admin@51purse.com",
        "phone": null,
        "role": 0,
        "createTime": 1479048325000,
        "updateTime": 1479048325000
    }
})
```

*App.vue中的调用与第二个方法相同*

## 商城首页

### Nav-Header组件(1)

引入默认的样式属性

App.vue
```vue
<template>
  <div id="app">
    <router-view></router-view>
  </div>
</template>

<script>
export default {
  name: 'App',
  data() {
    return {

    }
  },
  mounted() {
    
  }
}
</script>

<style>
@import './assets/scss/reset.scss';

</style>
```

reset.scss
```scss
body,div,p,h1,h2,h3,h4,h5,h6,ul,li,dl,dt,a,input,button,textarea,select{
  margin: 0;
  padding: 0;
  outline: none;
}
html,body{
  font-family:Helvetica Neue,Helvetica,Arial,Microsoft Yahei,Hiragino Sans GB,Heiti SC,WenQuanYi Micro Hei,sans-serif;
  color: #333333;
  background-color: #ffffff;
  min-width: 1226px;
  font-size: 12px;
}
a{
  text-decoration: none;
}
ul,li{
  list-style: none;
}
input{
  font: normal;
}
input:focus,a:focus{
  outline: none;
}
```

NavHeader.vue
```vue
<template>
  <div class="header">
		<div class="nav-topbar">
			<div class="container">
				<div class="topbar-menu">
					<a href="javascript:;">小米商城</a>
					<a href="javascript:;">MUI</a>
					<a href="javascript:;">云服务</a>
					<a href="javascript:;">协议规则</a>
				</div>
				<div class="topbar-user">
					<a href="javascript:;">登录</a>
					<a href="javascript:;">注册</a>
					<a href="javascript:;" class="my-cart"><span class="icon-cart"></span>购物车</a>
				</div>
			</div>
		</div>
		<div class="nav-header">

		</div>
	</div>
</template>
<script>
export default {
  name: 'nav-header'
}
</script>
<style lang="scss">
	.header {
		.nav-topbar {
			height: 39px;
			line-height: 39px;
			background-color: #333333;
			color: #b0b0b0;
			.container {
				width: 1226px;
				margin-right: auto;
				margin-left: auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
				a {
					display: inline-block;
					color: #b0b0b0;
					margin-right: 17px;
				}
				.my-cart {
					width: 110px;
					background-color: #FF6600;
					text-align: center;
					color: #FFFFFF;
					.icon-cart {
						display: inline-block;
						width: 16px;
						height: 12px;
						background: url('/imgs/icon-cart-checked.png') no-repeat center;
						background-size: contain;
						margin-right: 4px;
					}
				}
			}
		}
	}
</style>
```

### Nav-Header组件(2)

提取基础样式

base.scss

```scss
.container {
  width: 1226px;
  margin-right: auto;
  margin-left: auto;
}
```

通过mixin提取样式作为scss样式函数

mixin.scss
```scss
// flex布局复用
@mixin flex ($hov: space-between, $col: center) {
  display: flex;
  justify-content: $hov;
  align-items: $col;
}

@mixin bgImg($w: 0, $h: 0, $img: '', $size:  contain) {
  display: inline-block;
  width: $w;
  height: $h;
  background: url($img) no-repeat center;
  background-size: $size;
}
```

NavHeader.vue
```vue
<template>
  <div class="header">
		<div class="nav-topbar">
			<div class="container">
				<div class="topbar-menu">
					<a href="javascript:;">小米商城</a>
					<a href="javascript:;">MUI</a>
					<a href="javascript:;">云服务</a>
					<a href="javascript:;">协议规则</a>
				</div>
				<div class="topbar-user">
					<a href="javascript:;">登录</a>
					<a href="javascript:;">注册</a>
					<a href="javascript:;" class="my-cart"><span class="icon-cart"></span>购物车</a>
				</div>
			</div>
		</div>
		<div class="nav-header">
			<div class="container">
				<div class="header-logo">
					<a href="/#/index"></a>
				</div>
				<div class="header-menu">
					<div class="item-menu">
						<span>小米手机</span>
						<div class="children"></div>
					</div>
					<div class="item-menu">
						<span>RedMi红米</span>
						<div class="children"></div>
					</div>
					<div class="item-menu">
						<span>电视</span>
						<div class="children"></div>
					</div>		
				</div>
				<div class="header-search">
					<div class="wrapper">
						<input type="text" name="keyword">
						<a href="javascript:;"></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</template>
<script>
export default {
  name: 'nav-header'
}
</script>
<style lang="scss">
	@import './../assets/scss/base.scss';
	@import './../assets/scss/mixin.scss';

	.header {
		.nav-topbar {
			height: 39px;
			line-height: 39px;
			background-color: #333333;
			color: #b0b0b0;
			.container {
				@include flex();
				a {
					display: inline-block;
					color: #b0b0b0;
					margin-right: 17px;
				}
				.my-cart {
					width: 110px;
					background-color: #FF6600;
					text-align: center;
					color: #FFFFFF;
					.icon-cart {
						@include bgImg(16px, 12px, '/imgs/icon-cart-checked.png');
						margin-right: 4px;
					}
				}
			}
		}
		.nav-header {
			.container {
				@include flex();
				height: 112px;
				.header-logo {
					display: inline-block;
					width: 55px;
					height: 55px;
					background-color: #FF6600;
					a {
						display: inline-block;
						width: 110px;
						height: 55px;
						&:before {
							content: ' ';
							@include bgImg(55px, 55px, '/imgs/mi-logo.png', 55px);
							transition: margin .2s;
						}
						&:after {
							content: ' ';
							@include bgImg(55px, 55px, '/imgs/mi-home.png', 55px);
							background-size: 55px;
						}
						&:hover:before {
							margin-left: -55px;
							transition: margin .2s;
						}
					}
				}
				.header-menu {
					display: inline-block;
					width: 643px;
					padding-left: 209px;
					.item-menu {
						display: inline-block;
						color: #333333;
						font-weight: bold;
						font-weight: 16px;
						font-size: 16px;
						line-height: 112px;
						margin-right: 20px;
						span {
							cursor: pointer;
						}
						&:hover {
							
						}
					}
				}
				.header-search {
					width: 319px;
					.wrapper {
						height: 50px;
						border: 1px solid #E0E0E0;
						display: flex;
						align-items: center;
						input {
							border: none;
							box-sizing: border-box;
							border-right: 1px solid #E0E0E0;
							width: 264px;
							height: 50px;
							padding-left: 14px;
						}
						a {
							@include bgImg(18px, 18px, '/imgs/icon-search.png');
							margin-left: 17px;
						}
					}
				}
			}
		}
	}
</style>
```

### Nav-Header组建(3)
#### 完成下拉导航
